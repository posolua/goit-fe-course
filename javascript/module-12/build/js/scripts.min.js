"use strict";var form=document.querySelector(".js-form"),inputLink=document.querySelector("input[name=link]"),addBtn=document.querySelector(".form button"),container=document.querySelector("#root"),sourse=document.querySelector("#card").innerHTML.trim(),delBtn=document.querySelector("#root");addBtn.addEventListener("click",onClickAdd),delBtn.addEventListener("click",onClickDel);var constants={links:[]};function onClickDel(t){var e=t.target,n=e.nodeName,o=e.dataset.action;if("BUTTON"===n&&"delete"===o){var r=t.target.closest(".link-card"),a=Number(t.target.parentNode.dataset.id),i=constants.links.filter(function(t){return t.id!==a});constants.links=i,setLocalStorage(),r.remove(),console.log("constants.links",constants.links)}}function onClickAdd(t){var e=t.target,n=e.dataset.action;"BUTTON"===e.nodeName&&"add"===n&&(t.preventDefault(),isEnteredUrlValid()?getLinkData().then(function(t){console.log("data",t);var e={link:inputLink.value.trim(),id:Date.now(),img:t.image,title:t.title};constants.links.unshift(e),createTemplate(),console.log("constants.links:",constants.links),setLocalStorage(),form.reset()}):form.reset())}function isEnteredUrlValid(){var t=inputLink.value.trim(),e=/^((https?|ftp)\:\/\/)/.test(t),n=constants.links.some(function(t){return t.link===inputLink.value.trim()});return e?!n||(alert("Such a bookmark already exists"),!1):(alert("Your URL is not valid"),!1)}function createTemplate(){var t=Handlebars.compile(sourse)(constants.links[0]);container.insertAdjacentHTML("afterbegin",t)}function createTemplateFromLs(){var t=JSON.parse(localStorage.getItem("links"));if(null!==t){constants.links=t;var e=Handlebars.compile(sourse);console.log("templete from ls",e);var n=constants.links.reduce(function(t,n){return t+e(n)},"");container.insertAdjacentHTML("afterbegin",n)}}function getLinkData(){var t=inputLink.value.trim();return fetch("https://api.linkpreview.net/?key=5ba0af33f2af89d0737b612698e2451865b0a0af180af&q="+t).then(function(t){if(console.log("response.json()",t.json),t.ok)return t.json();throw new Error("Error while fetching: "+t.statusText)}).catch(function(t){return console.log(t)})}function setLocalStorage(){localStorage.setItem("links",JSON.stringify(constants.links))}createTemplateFromLs();